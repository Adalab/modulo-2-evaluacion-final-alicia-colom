"use strict";let searchArray=[],favArray=[];function SearchItem(a,e,t,r){this.showId=a,this.showName=e,this.showImage=t,this.showStatus=r}function FavItem(a,e,t,r,s){this.showId=a,this.showName=e,this.showImage=t,this.showAlt=r,this.showTitle=s}const btnSearch=document.querySelector(".js-searchBtn"),textAreaSearch=document.querySelector(".js-searchTextArea"),warningSearch=document.querySelector(".js-searchWarning");function handleSearch(){searchArray=[];const a=textAreaSearch.value;a?(warningSearch.classList.add("hidden"),fetch("//api.tvmaze.com/search/shows?q="+a).then(a=>a.json()).then(a=>{for(let e=0;e<a.length;e++){const t=a[e].show.id,r=a[e].show.name,s=existMediumImg(a[e].show.image),c=a[e].show.status;searchArray.push(new SearchItem(t,r,s,c))}paintSearch(),addFavEvent()})):warningSearch.classList.remove("hidden")}function existMediumImg(a){return null!==a&&null!==a.medium?a.medium:"//via.placeholder.com/210x295/de4242/282d4f/?text=CODEFLIX"}const mainSearch=document.querySelector(".js-searchMain"),containerSearch=document.querySelector(".js-searchList");function paintSearch(){mainSearch.classList.remove("hide");let a="";for(let e=0;e<searchArray.length;e++)favArray.find(a=>a.showId===searchArray[e].showId)?a+=`<li class="js-searchItem searchList__searchItem center addFav" data-id="${searchArray[e].showId}">`:a+=`<li class="js-searchItem searchList__searchItem center" data-id="${searchArray[e].showId}">`,a+=`<h3 class="js-searchItemTitle searchList__searchItem--title" href="#0">${searchArray[e].showName}</h3>`,a+=`<p class="js-status">${searchArray[e].showStatus}</p>`,a+=`<img class="js-searchItemImg searchList__searchItem--img" src="${searchArray[e].showImage}" alt="Imagen del cartel de ${searchArray[e].showName}" title="Cartel de ${searchArray[e].showName}"/>`,a+="</li>",containerSearch.innerHTML=a;addFavEvent()}function addFavEvent(){const a=document.querySelectorAll(".js-searchItem");for(const e of a)e.addEventListener("click",handleFav)}function handleFav(a){const e=parseInt(a.currentTarget.dataset.id),t=a.currentTarget.querySelector(".js-searchItemTitle"),r=a.currentTarget.querySelector(".js-searchItemImg");a.currentTarget.classList.contains("addFav")?(a.currentTarget.classList.remove("addFav"),favArray=favArray.filter(a=>a.showId!==e),paintFav(),storeData()):(a.currentTarget.classList.add("addFav"),favArray.push(new FavItem(e,t.innerHTML,r.src,"Imagen del cartel de "+t.innerHTML,"Cartel de "+t.innerHTML)),paintFav(),storeData())}btnSearch.addEventListener("click",handleSearch);const containerFav=document.querySelector(".js-favList");function paintFav(){let a="";if(0===favArray.length)containerFav.innerHTML='<div class="aside__favList--advice"><p>Tu lista de favoritos está vacía.</p><p>Realiza una búsqueda e incluye aquí tu selección.</p></div>';else{for(let e=0;e<favArray.length;e++)a+=`<li class="js-favItem favList__favItem" data-id="${favArray[e].showId}">`,a+=`<button class="js-btnQuit favList__favItem--btnQuit" data-id="${favArray[e].showId}" title="Eliminar de favoritos">x</button>`,a+=`<h3 class="js-favItemTitle favList__favItem--title">${favArray[e].showName}</h3>`,a+=`<img class="js-favItemImg favList__favItem--img" src="${favArray[e].showImage}" alt="${favArray[e].showAlt}" title="${favArray[e].showTitle}"/>`,a+="</li>",containerFav.innerHTML=a;addQuitFavEvent()}}function addQuitFavEvent(){const a=document.querySelectorAll(".js-btnQuit");for(const e of a)e.addEventListener("click",handleQuitFav)}function handleQuitFav(a){const e=parseInt(a.currentTarget.dataset.id);favArray=favArray.filter(a=>a.showId!==e),paintFav(),paintSearch(),storeData()}function storeData(){const a=JSON.stringify(favArray);localStorage.setItem("filledData",a)}function chargeData(){const a=localStorage.getItem("filledData"),e=JSON.parse(a);null!==e&&(favArray=e),paintFav()}chargeData();const headerFav=document.querySelector(".js-favHeader"),arrow=document.querySelector(".js-arrow");function collapseFav(){containerFav.classList.toggle("collapse"),arrow.classList.toggle("aside__favList--arrowUp"),arrow.classList.toggle("aside__favList--arrowDown"),containerFav.innerHTML.length}headerFav.addEventListener("click",collapseFav);