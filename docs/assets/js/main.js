"use strict";let searchArray=[],favArray=[];function searchItem(e,a,t){this.showId=e,this.showName=a,this.showImage=t}function favItem(e,a,t,r,s){this.showId=e,this.showName=a,this.showImage=t,this.showAlt=r,this.showTitle=s}const btnSearch=document.querySelector(".js-searchBtn"),textAreaSearch=document.querySelector(".js-searchTextArea"),warningSearch=document.querySelector(".js-searchWarning");function handleSearch(){searchArray=[];const e=textAreaSearch.value;e?(warningSearch.classList.add("hidden"),fetch("//api.tvmaze.com/search/shows?q="+e).then(e=>e.json()).then(e=>{for(let a=0;a<e.length;a++){const t=e[a].show.id,r=e[a].show.name,s=existMediumImg(e[a].show.image);searchArray.push(new searchItem(t,r,s))}paintSearch(),addFavEvent()})):warningSearch.classList.remove("hidden")}function existMediumImg(e){return null!==e&&null!==e.medium?e.medium:"//via.placeholder.com/210x295/de4242/282d4f/?text=CODEFLIX"}const mainSearch=document.querySelector(".js-searchMain"),containerSearch=document.querySelector(".js-searchList");function paintSearch(){mainSearch.classList.remove("hide");let e="";for(let a=0;a<searchArray.length;a++)favArray.find(e=>e.showId===searchArray[a].showId)?e+=`<li class="js-searchItem searchList__searchItem center addFav" data-id="${searchArray[a].showId}">`:e+=`<li class="js-searchItem searchList__searchItem center" data-id="${searchArray[a].showId}">`,e+=`<h3 class="js-searchItemTitle searchList__searchItem--title" href="#0">${searchArray[a].showName}</h3>`,e+=`<img class="js-searchItemImg searchList__searchItem--img" src="${searchArray[a].showImage}" alt="Imagen del cartel de ${searchArray[a].showName}" title="Cartel de ${searchArray[a].showName}"/>`,e+="</li>",containerSearch.innerHTML=e}function addFavEvent(){const e=document.querySelectorAll(".js-searchItem");for(const a of e)a.addEventListener("click",handleFav)}function handleFav(e){const a=parseInt(e.currentTarget.dataset.id),t=e.currentTarget.querySelector(".js-searchItemTitle"),r=e.currentTarget.querySelector(".js-searchItemImg");e.currentTarget.classList.contains("addFav")?(e.currentTarget.classList.remove("addFav"),favArray=favArray.filter(e=>e.showId!==a),paintFav(),storeData()):(e.currentTarget.classList.add("addFav"),favArray.push(new favItem(a,t.innerHTML,r.src,"Imagen del cartel de "+t.innerHTML,"Cartel de "+t.innerHTML)),paintFav(),storeData())}btnSearch.addEventListener("click",handleSearch);const containerFav=document.querySelector(".js-favList");function paintFav(){let e="";if(0===favArray.length)containerFav.innerHTML='<div class="aside__favList--advice"><p>Tu lista de favoritos está vacía.</p><p>Realiza una búsqueda e incluye aquí tu selección.</p></div>';else{for(let a=0;a<favArray.length;a++)e+=`<li class="js-favItem favList__favItem" data-id="${favArray[a].showId}">`,e+=`<button class="js-btnQuit favList__favItem--btnQuit" data-id="${favArray[a].showId}" title="Eliminar de favoritos">x</button>`,e+=`<h3 class="js-favItemTitle favList__favItem--title">${favArray[a].showName}</h3>`,e+=`<img class="js-favItemImg favList__favItem--img" src="${favArray[a].showImage}" alt="${favArray[a].showAlt}" title="${favArray[a].showTitle}"/>`,e+="</li>",containerFav.innerHTML=e;addQuitFavEvent()}}function addQuitFavEvent(){const e=document.querySelectorAll(".js-btnQuit");for(const a of e)a.addEventListener("click",handleQuitFav)}function handleQuitFav(e){const a=parseInt(e.currentTarget.dataset.id);favArray=favArray.filter(e=>e.showId!==a),paintFav(),paintSearch(),storeData()}function storeData(){const e=JSON.stringify(favArray);localStorage.setItem("filledData",e)}function chargeData(){const e=localStorage.getItem("filledData"),a=JSON.parse(e);null!==a&&(favArray=a),paintFav()}chargeData();const headerFav=document.querySelector(".js-favHeader"),arrow=document.querySelector(".js-arrow");function collapseFav(){containerFav.classList.toggle("collapse"),arrow.classList.toggle("aside__favList--arrowUp"),arrow.classList.toggle("aside__favList--arrowDown"),containerFav.innerHTML.length}headerFav.addEventListener("click",collapseFav);